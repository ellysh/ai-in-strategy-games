## 3.5 История шахматных программ

Современные шахматные программы объединяют в себе очень старые по меркам ИТ отрасли и самые передовые технологии. Они используют алгоритмы поиска, разработанные в 1920-х годах. В то же время некоторые их компоненты построены с использованием новейших алгоритмов и моделей машинного обучения.

Почему шахматные программы устроены именно так, а не иначе? Чтобы ответить на этот вопрос, надо обратиться к истории. Современные программы не оставляют шансов лучшим шахматистам. Но их разработка была долгим путём проб и ошибок. После многочисленных экспериментов разработчики нашли алгоритмы, которые лучше всего подходят для игры в шахматы.

Рассмотрим три проекта, которые оказали огромное влияние на современные компьютерные шахматы.

### 3.5.1 Шахматная программа Бернштейна

Первую полноценную шахматную программу создали сотрудники IBM в 1957 году. Этот проект был одним из ряда исследований в области ИИ, которые проводила компания. В команду проекта входили Алекс Бернштейн, Майкл Робертс, Тимоти Арбакл и Мартин Бельски. Шахматная программа получила название [The Bernstein Chess Program](https://www.chessprogramming.org/The_Bernstein_Chess_Program) (шахматная программа Бернштейна) по имени руководителя проекта.

Для разработки программы команда Алекса Бернштейна использовала новейший компьютер [общего назначения](https://ru.wikipedia.org/wiki/Компьютер_общего_назначения) [IBM 704](https://ru.wikipedia.org/wiki/IBM_704). Он был одной из последних коммерческих машин, которая работала на электронных лампах. Главное преимущество IBM 704 заключалось в большом по меркам того времени объёме памяти в 4000 слов (word). Одно слово состояло из 36 бит. Таким образом память компьютера составляла 18000 байт. Когда шахматная программа Бернштейна была готова, размер памяти IBM 704 увеличился в два раза до 36000 байт.

Во время работы Алекс Бернштейн консультировался с Клодом Шенноном, Джоном Маккарти, а также другими командами разработчиков шахматных программ. Кроме этого, проект поддерживали известные шахматисты: теоретик игры и международный мастер [Эдуард Ласкер](https://ru.wikipedia.org/wiki/Ласкер,_Эдуард) и американский гроссмейстер Артур Бисгайер.

{caption: "Иллюстрация 3-2. Алекс Бернштейн тестирует свою программу на IBM 704", height: "50%"}
![Алекс Бернштейн](images/Chess/alex-bernstein.jpg)

Алекс Бернштейн был первым, кто включил в шахматную программу таблицы дебютов. В начале партии она отыгрывала заранее определённые последовательности хороших ходов. Это усилило игру программы и сэкономило скромные по современным меркам вычислительные ресурсы компьютера.

После окончания дебютной таблицы, программа переключалась на алгоритм поиска ходов. Это была вариация стратегии типа B Клода Шеннона. Сначала программа применяла эвристики и выбирала семь наиболее перспективных ходов в текущей позиции. Эти отобранные ходы просчитывались вглубь с помощью алгоритма минимакс. Алгоритм использовал функцию оценки, которая учитывала следующие качества позиции:

1. Выигрыш материала
2. Подвижность фигур
3. Контроль доски
4. Безопасность короля.

Минимаксный алгоритм давал программе ход, который приводил к лучшей возможной позиции для неё и худшей возможной позиции для оппонента. Именно этот ход и делала программа.

Из-за ограниченной вычислительной мощности компьютера IBM 704 программа просчитывала только четыре полухода вперёд. На это она тратила в среднем 8 минут.

I> Термин **полуход** используют разработчики шахматных программ. Он означает ход одной из сторон: белых или чёрных. Два полухода составляют один полный ход.

Финальная версия программы Бернштейна играла на уровне новичка. Её уровень Эло был ниже 1000: предположительно в диапазоне от 400 до 700. Она могла выиграть партию только у начинающих игроков. Тем не менее этот проект доказал, что компьютер в принципе может играть в шахматы.

### 3.5.2 Шахматный компьютер Belle

В августе 1969 года сотрудники корпорации Bell Labs Кен Томпсон и Деннис Ритчи разработали операционную систему Unix для миникомпьютера PDP-7. Кен Томпсон был любителем шахмат. В качестве эксперимента он решил написать шахматную программу, работающую на новой ОС. Программа получила название [Belle](https://www.chessprogramming.org/Belle).

Проект Belle начинался как разработка шахматной программы для компьютера общего назначения. Позднее к Кену Томпсону присоединился его коллега Джо Кондон. Он предложил сконструировать специальный компьютер, оптимизированный для генерации шахматных ходов и оценки позиций фигур. Такое оборудование позволяло преодолеть ограниченную вычислительную мощность компьютеров общего назначения того времени. Кен Томпсон одобрил идею Джо Кондона. Вместе они начали собирать компьютер, который тоже получил название Belle.

В работе над Belle Джо Кондон использовал стандартные чипы серийного производства. Их легко было найти на рынке и стоили они относительно недорого. Инженер собирал специализированный шахматный компьютер на стандартных компонентах. Это привело к тому, что между модулями компьютера были многочисленные проводные соединения. Такая архитектура выполняла шахматные расчёты намного быстрее, чем компьютеры общего назначения. Но многочисленные соединения замедляли вычисления. У архитектуры был потенциал для дальнейших улучшений.

Чипы в компьютере Bell представляли собой малые (МИС) и [средние интегральные схемы](https://ru.wikipedia.org/wiki/Интегральная_схема#По_степени_интеграции) (СИС). Такие схемы содержат от 100 до 1000 элементов на одном кристалле.

{caption: "Иллюстрация 3-3. Шахматный компьютер Belle"}
![Компьютер Belle](images/Chess/belle.jpg)

Компьютер Belle состоял из трёх аппаратных модулей:

1. Генератор ходов ([move generator](https://www.chessprogramming.org/Move_Generation))

2. Модуль оценки позиции ([position evaluator](https://www.chessprogramming.org/Evaluation))

3. Таблица транспозиций ([transposition table](https://www.chessprogramming.org/Transposition_Table))

**Генератор ходов** использовал эвристику под названием **самая ценная жертва, наименее ценный агрессор** (Most Valuable Victim - Least Valuable Aggressor или [MVV-LVA](https://www.chessprogramming.org/MVV-LVA). Её идея состоит в том, чтобы среди атакованных фигур противника найти самую ценную. Она называется **жертвой**. Ценность фигур убывает в таком порядке: ферзь, ладья, слон, конь, пешка. Следующий шаг — найти наименее ценную фигуру из тех, которые атакуют жертву. Такая фигура называется **агрессором**. После этого эвристика возвращает набор ходов с атакой самой ценной жертвы наименее ценным агрессором. Несмотря на свою простоту, MVV-LVA находит перспективные ходы во многих игровых позициях.

**Модуль оценки позиции** даёт численную оценку каждой позиции, которую рассматривает шахматный компьютер. Это может быть позиция, полученная в результате перспективного хода или наиболее вероятного ответа оппонента. Модуль оценки учитывает несколько факторов:

* Позицию и безопасность короля в зависимости от стадии партии.

* Пешечную структуру.

* Мобильность фигур.

* Открытые диагонали и линии.

* Таблицу фигур и полей.

[**Таблица фигур и полей**](https://www.chessprogramming.org/Piece-Square_Tables) составляется для каждой черной и белой фигуры. Таблица представляет собой численные оценки клеток, которые фигура может занять на доске. Чем выше оценка, тем выгоднее позиция. Расположение других фигур таблица не учитывает. Благодаря таблице, шахматная программа может быстро оценить насколько выгодно занимать фигурой ту или иную клетку на доске.

Третий аппаратный модуль Belle — **таблица транспозиций**. В ней сохраняется оценка позиций, которые программа находит в результате итераций поиска. В одну и ту же позицию ведут разные последовательности ходов. Эти последовательности называются **транспозициями**. Благодаря таблице, компьютер не тратит время на оценку проверенных ранее позиций. Это значительно ускоряет поиск по дереву игры.

Компьютер Belle следовал стратегии типа А Клода Шеннона. Он использовал модуль оценки позиции при просчёте ходов в глубину. Сначала генератор ходов давал несколько перспективных ходов в текущей позиции. Для каждого из них Belle выполнял поиск по дереву игры с помощью алгоритма минимакс с альфа-бета отсечением. Каждая проверенная в ходе поиска позиция сохранялась в таблице транспозиций. Если компьютеру надо было оценить какую-то позицию, сначала он обращался к таблице транспозиций. Если позиции там не было, её обрабатывал модуль оценки позиций. Алгоритм минимакс определял лучший из перспективных ходов. Его и выполнял компьютер.

Первая неоптимизированная версия компьютера Belle просчитывала позиции на четыре полухода вперёд. В версии 1978 года глубина просчёта увеличилась до восьми полуходов. Разработчики не остановились на этом результате и продолжили улучшать программную и аппаратную часть компьютера.

Также как шахматная программа Бернштейна, компьютер Belle отыгрывал начало партии по таблице дебютов. Кроме этого Кен Томпсон впервые включил в программу базу данных шахматных окончаний. Она содержала все технические и решённые к тому времени сложные четырёхфигурные окончания. Эта базы данных значительно усилила игру Belle в эндшпиле.

В 1978 году компьютер Belle впервые участвовал в [Северо-Американском чемпионате по шахматам среди компьютерных программ](https://ru.wikipedia.org/wiki/Северо-Американский_чемпионат_по_шахматам_среди_компьютерных_программ) (ACM North American Computer Chess Championship) и занял на нём первое место. Организатором чемпионата была [Ассоциация вычислительной техники](https://ru.wikipedia.org/wiki/Ассоциация_вычислительной_техники) (Association for Computing Machinery, ACM). Это старейшая и наиболее крупная международная организация в компьютерной области со штаб-квартирой в Нью-Йорке. В следующие годы Belle ещё четыре раза выигрывал этот чемпионат.

В 1980 Belle выиграл [чемпионат мира по шахматам среди компьютерных программ](https://ru.wikipedia.org/wiki/Чемпионат_мира_по_шахматам_среди_компьютерных_программ) (World Computer Chess Championship или WCCC), который проходил в австрийском городе Линц.

В 1983 году компьютер Belle достиг рейтинга в 2250 пунктов Эло, что соответствует уровню мастера. За это достижение команда его разработчиков получила первую [премию Фредкина](https://www.chessprogramming.org/Edward_Fredkin#Prize) в размере 5000$.

Премию Фредкина учредил университет Карнеги — Меллона в 1980 году. Основная сумма составляла 100000$ за победу над действующим чемпионом мира по шахматам. Средства предоставлял фонд, основанный профессором Массачусетского технологического института Эдвардом Фредкином. Поэтому награда была названа в его честь. Она состояла из трёх частей:

1. 5000$ за достижения уровня игры мастера.
2. 10000$ за достижения уровня игры интернационального мастера.
3. 100000$ за победу над действующим чемпионом мира.

Учредители премии рассчитывали, что она будет стимулировать исследования в компьютерных шахматах. Это ожидание оказалось верным. Разработчиков привлекало не столько денежное вознаграждение, сколько престижность награды.

Успехи компьютера Belle продемонстрировали потенциал специализированного оборудования и оптимизированных алгоритмов поиска. Они ещё раз убедили разработчиков в превосходстве стратегии A над стратегией B Клода Шеннона. Многие команды последовали по пути разработки специализированного шахматного компьютера. Одной из них была команда Deep Blue.

### 3.5.3 Шахматный компьютер Deep Blue

11 мая 1997 года шахматный компьютер [Deep Blue](https://ru.wikipedia.org/wiki/Deep_Blue) победил действующего чемпиона мира по шахматам Гарри Каспарова. Этот матч стал переломным моментом в истории компьютерных шахмат. Он поставил точку в спорах о том, может ли машина в принципе превзойти человека в этой игре.

Небольшая группа исследователей разрабатывала Deep Blue на протяжении 10 лет. Мы рассмотрим историю создания этого компьютера во всех подробностях. Она многое расскажет нам об устройстве и работе современных шахматных программ.

#### 3.5.3.1 ChipTest

В 1979 году профессор Калифорнийского технологического института Карвер Мид и учёный Линн Конвей опубликовали книгу "Введение в сверхбольшие интегральные схемы" (Introduction to VLSI Systems). В ней авторы описали правила проектирования схем и предложили способы автоматизации этого процесса. Книга положила начало [революции сверхбольших интегральных схем](https://en.wikipedia.org/wiki/Mead–Conway_VLSI_chip_design_revolution) (СБИС). Многие университеты добавили курс проектирования СБИС в свою программу. Новое направление стало темой многих дипломных работ и докторских диссертаций.

С середины 1980-х годов в университете Карнеги — Меллона группа аспирантов и преподавателей разрабатывала шахматный компьютер [HiTech](https://www.chessprogramming.org/HiTech). Проектом руководил заслуженный эксперт по шахматным программам профессор [Ханс Берлинер](https://www.chessprogramming.org/Hans_Berliner). Он также был сильным игроком и удерживал титул чемпиона мира по шахматам по переписке с 1968 по 1971 год.

HiTech был исследовательским проектом в рамках изучения возможностей СБИС. Он следовал по проверенному пути шахматного компьютера Belle. Команда разработчиков собирала HiTech на стандартных чипах серийного производства. Главное отличие от Belle заключалось в аппаратной архитектуре и самих чипах. Belle использовал МИС и СИС, а HiTech — более производительные и мощные СБИС.

Компьютер HiTech состоял из трёх аппаратных модулей:

1. Генератор ходов.

2. Модуль оценки позиции.

3. **Модуль контроля поиска** — определяет порядок, в котором шахматный компьютер просчитывает последовательности ходов.

Ханс Берлинер делал ставку не на производительное оборудование, а на новый алгоритм поиска. Учёный разработал его в начале 1980-х годов и назвал стратегией B* по аналогии со стратегиями A и B Клода Шеннона. **Стратегия B*** — это выборочный поиск, который увеличивает глубину просчёта для перспективных ходов и сокращает для неперспективных.

Аппаратную часть HiTech разрабатывали аспиранты с опытом в области электротехники. В 1985 году Ханс Берлинер обратился за помощью к [Фэн Сюн Сю](https://www.chessprogramming.org/Feng-hsiung_Hsu).

Фэн Сюн Сю переехал в США из Тайваня в 1982 году и поступил на кафедру информатики (computer science) университета Карнеги — Меллона. Он участвовал в коммерческом проекте для General Electrics, который кафедра выполняла совместно с японской компанией Matsushita Electric. Там аспирант получил хороший опыт разработки чипов с нуля.

Ханс Берлинер предложил Фэн Сюн Сю разработать модуль оценочной функции. К этому моменту у HiTech уже был генератор ходов, который выполнялся на 64-х чипах. Архитектура компьютера предполагала, что каждому полю доски соответствует отдельный чип. На этих же самых чипах должна была выполняться и оценочная функция. Главный недостаток такой архитектуры заключался в многочисленных соединениях и обмене данными между чипами. На коммуникацию расходовалась значительная часть вычислительной мощности компьютера.

Опираясь на свой опыт, Фэн Сюн Сю пересмотрел архитектуру HiTech. Он предложил вместо стандартных чипов использовать специализированные. Аспирант упростил схему генератора ходов HiTech. Затем он придумал способ разместить его на одном специализированном СБИС чипе вместо 64-х стандартных. После этого он оптимизировал модуль оценочной функции. Это позволило поместить его в тот же чип, что и генератор ходов. Таким образом Фэн Сюн Сю разместил два основных механизма шахматного компьютера на одном единственном чипе.

Переход к системе на одном чипе должен был увеличить производительность HiTech примерно в 20 раз. Несмотря на это, Ханс Берлинер отклонил идеи Фэн Сюн Сю. Он считал, что основная игровая сила HiTech не в скорости поиска, а в стратегии B*. Её выполнял модуль контроля поиска. Профессор стремился как можно скорее закончить разработку генератора ходов и модуля оценки позиций. После этого он смог бы заняться так интересующим его модулем контроля поиска.

Размышляя над архитектурой специализированного шахматного чипа, Фэн Сюн Сю увидел возможность решить **проблему компьютерных шахмат**. Так в научных кругах называлась задача разработки программы или компьютера, способного обыграть действующего чемпиона мира по шахматам. Традиционно эта проблема относилась к области ИИ. Но Фэн Сюн Сю считал её чисто инженерной задачей, которую можно решить специальными аппаратными средствами.

Фэн Сюн Сю разделил задачу на два этапа:

1. Создать шахматный компьютер, работающий на одном СБИС чипе.

2. Использовать большое количество шахматных чипов параллельно, чтобы значительно ускорить поиск.

Фэн Сюн Сю решил разработать свой собственный шахматный компьютер независимо от команды HiTech. К 1986 году он спроектировал специализированный шахматный чип с генератором ходов и минимальной оценочной функцией. Эта функция оценивала позицию на основе таблицы фигур и полей. Похожим механизмом пользовался компьютер Belle. Идея генератора ходов тоже была позаимствована из проекта Кена Томпсона. В его основе лежала эвристика "самая ценная жертва, наименее ценный агрессор" (MVV-LVA).

Возможностей чипа не хватало для игры в шахматы. Он реализовывал только часть механизмов полноценной шахматной программы. Фэн Сюн Сю решил, что работой чипа должен управлять компьютер общего назначения. На нём выполнялся минимаксный алгоритм с альфа-бета отсечением для поиска по дереву игры. Также компьютер дополнял оценку позиции следующими факторами: материал, пешечная структура, контроль полей, размещение и мобильность фигур.

Партию шахматных чипов изготовила компания [MOSIS](https://en.wikipedia.org/wiki/MOSIS). Она производила полупроводники и сотрудничала с американскими университетами. Изготовление чипов для учебных проектов финансировал [Национальный научный фонд США](https://ru.wikipedia.org/wiki/Национальный_научный_фонд) (National Science Foundation, NSF) и DARPA. Студенты отправляли в MOSIS свои схемы и бесплатно получали по почте готовые чипы. Единственная проблема была в том, что в середине 1980-х годов MOSIS ещё плохо освоила изготовление СБИС. Поэтому в производстве часто встречался брак.

Для проверки полученных чипов Фэн Сюн Сю написал программу. Она проверяла базовые функции и обнаруживала брак производства. Такого теста было недостаточно для оценки производительности. Аспирант хотел запустить чип под управлением полноценной шахматной программы, которая бы сыграла несколько партий. Это позволило бы оценить скорость перебора позиций.

[Томас Анантараман](https://www.chessprogramming.org/Thomas_Anantharaman) тоже учился на кафедре информатики. У него уже была готовая шахматная программа для компьютера общего назначения. Он написал её в качестве хобби и не собирался развивать дальше. Томас Анантараман согласился помочь Фэн Сюн Сю с тестированием чипов. Он установил чипы в свой компьютер и адаптировал для них шахматную программу. В результате такая система смогла проверять около 30000 позиций в секунду. В 1986 году такую производительность имели только специализированные шахматные компьютеры и шахматные программы, запущенные на суперкомпьютерах.

Получив положительные результаты теста, Фэн Сюн Сю собрал шахматный компьютер на постоянном оборудовании. Для этого он получил от кафедры списанную рабочую станцию [Perq](https://ru.wikipedia.org/wiki/PERQ). Теперь аспирант мог независимо работать над чипами и алгоритмом поиска по дереву игры.

В это время к проекту присоединился [Мюррей Кэмпбелл](https://www.chessprogramming.org/Murray_Campbell). Он был сильнейшим шахматистом среди аспирантов. Его знания шахматной теории помогли при программировании оценочной функции.

Скоро программная часть шахматного компьютера стала достаточно стабильной. Он был готов для следующего этапа тестирования — игры против других компьютеров. Для этого команда разработчиков зарегистрировалась на ежегодный чемпионат ACM. В заявке на участие Фэн Сюн Сю назвал свой шахматный компьютер просто [ChipTest](https://en.wikipedia.org/wiki/ChipTest).

Во время чемпионата ACM 1986 года компьютер ChipTest просчитывал около 100000 позиций в секунду. Такая выдающаяся скорость позволила ему набрать 2.5 очка в пяти партиях: две победы, два поражения и одна ничья. Уже на следующем чемпионате ACM 1987 года скорость поиска ChipTest достигла 400000 позиций в секунду. Производительность выросла благодаря замене устаревшей рабочей станции Perq на более современную.

При подготовке к ACM 1987 года Томас Анантараман реализовал алгоритм **единственных продлений** ([singular extensions](https://www.chessprogramming.org/Singular_Extensions)). Он увеличивает глубину поиска в позициях, в которых оба игрока вынуждены делать единственный хороший ход. **Единственный хороший ход** значительно лучше всех возможных альтернатив. Поэтому игрок всегда выбирает именно его.

Другими улучшениями ChipTest к турниру были:

* Добавление оценки пешечной структуры.

* Исправление программных и аппаратных ошибок, которые привели к поражениям в партиях на турнире ACM 1986 года.

За год сила игры ChipTest выросла примерно на 300 очков Эло. Благодаря этому, компьютер занял первое место на турнире ACM 1987 года.

В 1987 году команду ChipTest пригласили на Открытый чемпионат Америки (American Open). В нём участвовали шахматные компьютеры и профессиональные шахматисты. Фэн Сюн Сю отказался от участия из-за возражений команды HiTech. Оценочная функция ChipTest использовала программный код, который Мюррей Кэмпбелл позаимствовал из HiTech. Это стало формальной причиной, почему компьютера ChipTest не было на турнире. Неформальная причина состояла в том, что Фэн Сюн Сю тратил всё своё время на разработку следующей версии шахматного чипа.

#### 3.5.3.2 Deep Thought

Успехи ChipTest показали преимущества компьютера собранного на специализированных чипах. Его производительность была недостижима для конкурирующих проектов. Это подтвердило перспективность архитектуры, разработанной Фэн Сюн Сю.

Следующей целью команды ChipTest была победа на турнире Fredkin Masters Open. Фонд Фредкина спонсировал не только премию, но и серию ежегодных шахматных турниров. Турниры проходили на протяжении 1980-х годов. В 1988 году планировался заключительный турнир этой серии. На Fredkin Masters Open лучшие шахматные программы играли против профессиональных шахматистов.

Команда ChipTest получила приглашение на Fredkin Masters Open благодаря победе на ACM 1987 года. Для участия в турнире Фэн Сюн Сю разработал новый шахматный чип. Он работал под управлением компьютера общего назначения, как и ChipTest. Собранный на новом чипе шахматный компьютер получил название Deep Thought в честь вымышленного суперкомпьютера из романа Дугласа Адамса "Автостопом по галактике".

Первая версия Deep Thought 0.01 была собрана в мае 1988 года. Она использовала один шахматный чип. В ноябре 1988 команда Фэн Сюн Сю наладила работу двухпроцессорной версии шахматного компьютера. Он получил название Deep Thought 0.02. Эта версия просчитывала 720000 позиций в секунду — почти в два раза быстрее чем ChipTest.

Deep Thought имел несколько преимуществ перед ChipTest. Прежде всего, он получил новую оценочную функцию. Как и раньше она состояла из двух частей: аппаратной и программной. Но теперь большую часть расчётов выполняла аппаратная часть. Шахматные чипы Deep Thought распознавали многие динамические признаки позиции: пешечную структуру, проходные пешки, ладьи на открытых вертикалях и т.д. Эти признаки использовались как примитивы для программной оценки. Её выполняла рабочая станция, к которой подключались оба чипа Deep Thought 0.02.

Мюррей Кэмпбелл написал программу для [автоматической настройки](https://www.tim-mann.org/deepthought.html) оценочной функции. Она рассчитывала важность разных факторов позиции на основе базы данных из 868 игр между гроссмейстерами. В результате автоматической настройки Deep Thought предпочитал те же ходы, что и гроссмейстеры в позициях из базы данных.

Одним из слабых мест ChipTest было отсутствие дебютной книги. В 1988 году к проекту присоединился одногруппник Фэн Сюн Сю — Майк Браун. Он написал программу для обработки всех доступных дебютных вариантов. Она сгенерировала дебютную книгу для Deep Thought. Это значительно усилило игру компьютера в дебюте.

На турнире Fredkin Masters Open играла версия Deep Thought 0.01, потому что версия 0.02 ещё не была достаточно стабильной. Благодаря всем улучшениям, компьютер разделил второе место с двумя мастерами. Он набрал 4,5 очка из 6 возможных. Его турнирный рейтинг составил 2599 пунктов Эло. ChipTest тоже участвовал в турнире и занял пятое место. Он набрал 4 очка из 6. Ему присвоили рейтинг 2521 пунктов Эло.

[Открытый чемпионат США по шахматам](https://ru.wikipedia.org/wiki/Открытый_чемпионат_США_по_шахматам) (The U.S. Open Championship) 1988 года в Бостоне стал первым турниром, в котором играла версия Deep Though 0.02 с двумя шахматными чипами. После первых трёх партий команда разработчиков обнаружила ошибки в коде для поддержки двух чипов. Поэтому остальные партии турнира играла программа Deep Though 0.01, запущенная на компьютере Deep Though 0.02. Она использовала только один шахматный чип. В турнире компьютер набрал 7 очков из 10 возможных. Его рейтинг снизился с 2599 до 2495 пунктов Эло.

Открытый чемпионат США стал хорошей проверкой для Deep Though 0.02. Команда разработчиков потратила два месяца на исправление обнаруженных программных ошибок. Это помогло Deep Though 0.02 выиграть турнир ACM 1988 года в Орландо, штат Флорида. На нём Deep Though впервые публично сыграл с HiTech и одержал победу.

В ноябре 1988 год Deep Thought играл в турнире Software Toolworks. Кроме американских шахматистов в нём участвовали игроки высшего уровня. Среди них был бывший чемпион мира [Михаил Таль](https://ru.wikipedia.org/wiki/Таль,_Михаил_Нехемьевич), претенденты [Бент Ларсен](https://ru.wikipedia.org/wiki/Ларсен,_Бент) и [Самуэль Решевский](https://ru.wikipedia.org/wiki/Решевский,_Самуэль). На момент турнира Таль занимал 16-е место в мировом рейтинге, а Ларсен — 42-е.

I> [**Претендентом**](https://ru.wikipedia.org/wiki/Турниры_претендентов_по_шахматам) в шахматах называется соперник действующего чемпиона мира.

Именно на турнире Software Toolworks Deep Thought стал первым компьютером, который победил гроссмейстера в партии с классическим контролем времени. Компьютеру проиграл Бент Ларсен. Первое место на турнире заняли Deep Thought и гроссмейстер Энтони Майлс.

Благодаря успехам на турнирах, команда Deep Though получила промежуточную премию Фредкина в размере 10000$. Их компьютер стал сильнейшим среди конкурентов и официально достиг уровня игры интернационального мастера.

{caption: "Иллюстрация 3-4. Команда Deep Thought в 1988 году: Мюррей Кемпбелл, Фэн Сюн Сю, Томас Анантараман, Майкл Браун, Андреас Новатчук"}
![Команда Deep Thought](images/Chess/deep-thought-team.jpg)

Команда Фэн Сюн Сю продолжала совершенствовать шахматный компьютер. К 1989 году он состоял из трёх [печатных плат](https://ru.wikipedia.org/wiki/Печатная_плата). На каждой из них размещались два шахматных чипа. Каждой платой управляла отдельная рабочая станция. Три станции соединялись через локальную сеть и вели параллельный поиск. Эта версия компьютера была в три раза быстрее, чем Deep Though 0.02.

В октябре 1989 года состоялся матч из двух игр между Deep Thought и действующим чемпионом мира Гарри Каспаровым. [В первой партии](https://lichess.org/j0Vfex0w) Гарри Каспаров играл чёрными. Он сыграл сицилианскую защиту в ответ на первый ход компьютера e2-e4. Стороны разменяли по две пешки в дебюте. В результате позиция Deep Thought оказалась несколько лучше: его фигуры были более развиты и контролировали центр.

На 13-ом ходу у Deep Thought начала проявляться ошибка в оценке позиции. Вместо рокировки короля компьютер делал слабые ходы. Первый из них приведён на иллюстрации 3-5.

{caption: "Иллюстрация 3-5. 13-й ход Deep Thought в 1-й партии", height: "40%"}
![13-й ход Deep Thought в 1-й партии](images/Chess/kasparov-vs-dt-1989-1st-game-13-turn.png)

Из-за ошибки Deep Thought смог рокироваться только на 17-ом ходу. К этому моменту его фигуры оказались рассредоточены на доске. Компьютер получил очень уязвимую для атаки позицию (см. иллюстрацию 3-6).

{caption: "Иллюстрация 3-6. Рокировка Deep Thought на 17-ом ходу в 1-й партии", height: "40%"}
![17-й ход Deep Thought в 1-й партии](images/Chess/kasparov-vs-dt-1989-1st-game-17-turn.png)

Гарри Каспаров решил воспользоваться слабой позицией Deep Thought и атаковал в центре. На 21-ом ходу он разменял своего слона на коня ходом Bxc3, а на 22-ом ходу разменял коней ходом Nf5. Далее обе стороны сдвоили ладей по вертикали e. Тем самым шахматист связал белого слона на поле e3.

Чтобы окончательно разрушить позицию белых, Гарри Каспаров начал продвижение пешек на королевском фланге (см. иллюстрацию 3-7). В результате этой атаки чёрные выиграли слона и вышли в эндшпиль с материальным преимуществом. Кроме того чёрная пешка на вертикали a была проходной. В такой безнадёжной позиции Фэн Сюн Сю сдался за Deep Thought.

{caption: "Иллюстрация 3-7. Гарри Каспаров продвигает пешки на королевском фланге, 29-й ход 1-й партии", height: "40%"}
![29-й ход Гарри Каспарова в 1-й партии](images/Chess/kasparov-vs-dt-1989-1st-game-29-turn.png)

[Во второй партии](https://lichess.org/1l9BGxUL) Гарри Каспаров играл белыми. Он разыграл [ферзевой гамбит](https://ru.wikipedia.org/wiki/Ферзевый_гамбит). Deep Thought принял жертву пешки. В результате на доске сложился [принятый ферзевой гамбит](https://ru.wikipedia.org/wiki/Принятый_ферзевый_гамбит).

Далее Гарри Каспаров сыграл нестандартное продолжение и тем самым вывел Deep Thought из его дебютной книги. Шахматист выдвинул королевскую пешку в центр ходом e4, а затем напал на чёрного коня ферзевой пешкой d5 (см. иллюстрацию 3-8).

{caption: "Иллюстрация 3-8. Гарри Каспаров атакует коня чёрных ферзевой пешкой на 5-ом ходу 2-й партии", height: "40%"}
![5-й ход Гарри Каспарова во 2-й партии](images/Chess/kasparov-vs-dt-1989-2nd-game-5-turn.png)

Лишившись книжных ходов, компьютер сыграл слабо. Он навязал размен конями и потерял обе пешки на вертикали c. В результате после 12-го хода белых фигуры Гарри Каспарова контролировали всю доску (см. иллюстрацию 3-9).

{caption: "Иллюстрация 3-9. Гарри Каспаров забирает чёрную пешку Bxc4 на 12-ом ходу 2-й партии", height: "40%"}
![12-й ход Гарри Каспарова во 2-й партии](images/Chess/kasparov-vs-dt-1989-2nd-game-12-turn.png)

Следующим ходом Qd6 Deep Thought вывел ферзя. Гарри Каспаров провёл атаку легкими фигурами и ферзём на королевском фланге. Она привела к размену белых коня и слона на чёрного ферзя. После этого позиция компьютера стала безнадёжной.

Гарри Каспаров осторожно реализовывал полученное преимущество в материале и позиции. Ошибка Deep Thought с рокировкой воспроизвелась снова. Она ещё более усугубила позицию компьютера. В результате Гарри Каспаров вышел в эндшпиль с ферзём против ладьи. Тогда на 37-ом ходу Мюррей Кемпбелл, выполнявший роль оператора, сдался.

Матч Deep Thought с Гарри Каспаровым продемонстрировал типичные недостатки шахматных компьютеров и программ конца 1980-х годов:

1. **Жадность к материалу**. Программы охотно разменивали позиционное преимущество на материал. Кроме того они всеми силами пытались избежать потери фигур. Это часто приводило к плохим позициям.

2. **Отсутствие позиционной игры**. Если не было очевидно хороших ходов, программа не развивала свою позицию. Она делала бессмысленные ходы и теряла темп.

3. **Слабая игра в дебюте**. Программы пользовались дебютными книгами, но в них не были заложены принципы дебютной теории. Они играли очень слабо при отклонении от стандартного начала.

4. **Слабая игра в эндшпиле**. Некоторые программы включали базу данных шахматных окончаний, но она содержала только простые эндшпили. В сложных окончаниях все программы играли слабо и часто упускали гарантированную победу.

5. **Программные ошибки**. В функции оценки позиций и алгоритме поиска часто встречались программные и аппаратные ошибки. Для их диагностики и исправления не было надёжных средств.

Матч с Гарри Каспаровым показал проблемы функции оценки позиций Deep Though. Разработчики компьютера занялись их исправлением. Также они оценили важность домашней подготовки. Перед началом матча шахматист получил распечатки всех публичных игр Deep Though. Он подготовился к началам, которые обычно разыгрывал компьютер. Благодаря этому, Гарри Каспаров выиграл вторую партию уже в дебюте.

#### 3.5.3.3 Версия Deep Blue 1996 года

В 1988 году до менеджеров IBM дошли слухи об успехах Deep Thought. Команду Фэн Сюн Сю пригласили на собеседование и предложили постоянные должности в исследовательском центре компании. В 1989 году все разработчики Deep Thought окончили университет и начали работу в IBM. Спустя некоторое время Томас Анантараман покинул проект. Его место занял штатный программист исследовательского центра IBM [Артур Джозеф Хоэн](https://www.chessprogramming.org/Joe_Hoane).

Команда занялась разработкой нового шахматного компьютера. Скоро встал вопрос о его названии. У широкой публики имя Deep Thought вызывало ассоциации с фильмом для взрослых "Deep Throat". Коллеги и репортеры в шутку часто путали эти названия. IBM провело конкурс среди сотрудников на новое имя. Среди предложенных вариантов победил Deep Blue. Это сочетание оригинального названия проекта Deep Thought и неофициального прозвища IBM — Big Blue (голубой гигант).

Производством чипов для Deep Blue занималась компания VLSI Technology. Она предоставляла своим клиентам инструменты для проектирования схем. Эти инструменты имели ограничения и поэтому Фэн Сюн Сю пришлось делать часть работы вручную. В результате незапланированных задержек пришлось отказаться от детектора повторений позиций. **Детектор повторений позиций** — это таблица транспозиций, реализованная на аппаратном уровне. Он сохраняет уже проверенные позиции и их оценку.

В 1995 году VLSI Technology поставила в IBM шахматные чипы Deep Blue. В течение семи лет с момента создания DeepThought технология производства СБИС постоянно развивалась. Более совершенная технология позволила увеличить плотность размещения логических модулей на кристалле. В результате один чип Deep Blue обрабатывал 1,6 миллиона позиций в секунду. Это в четыре раза выше скорости чипа Deep Thought.

Шахматный компьютер Deep Blue представлял собой рабочую станцию IBM, к которой подключались 216 шахматных чипов. Теоретическая скорость поиска компьютера составляла 300 миллионов позиций в секунду. Реальная наблюдаемая скорость во время игр была около 100 миллионов позиций в секунду. Причиной этой разницы были издержки программного обеспечения при параллельном поиске.

Оценочная функция Deep Blue складывалась из набора факторов. Большую их часть вычислял каждый шахматный чип самостоятельно. Лишь некоторые факторы для наиболее перспективных позиций рассчитывались управляющей программой на рабочей станции. Таким образом, чипы брали на себя основной объём шахматных расчётов. Каждый из них выполнял эти расчёты со скоростью универсального суперкомпьютера стоимостью несколько миллионов долларов. Это стало возможным благодаря высокой специализации чипов. Несмотря на некоторые аппаратные и программные проблемы, Deep Blue стал самым мощным шахматным компьютером из когда-либо созданных ранее.

Чтобы проверить силу игры Deep Blue, команда разработчиков провела матчи с классическим контролем времени против трёх сильнейших гроссмейстеров США. В этих матчах играла версия компьютера Deep Blue Junior. Она работала с гораздо меньшим числом шахматных чипов, чем финальная версия Deep Blue.

Каждый матч состоял из двух партий. Deep Blue Junior выиграл один матч со счётом 2-0, свёл другой в ничью 1-1 и один проиграл 0-2. Обыграть компьютер в двух партиях смог гроссмейстер [Джоэл Бенджамин](https://en.wikipedia.org/wiki/Joel_Benjamin). Его пригласили на должность консультанта в команду Deep Blue. Шахматист занимался дебютной подготовкой компьютера, улучшением оценочной функции и тестированием результатов.

Первый матч между Deep Blue и Гарри Каспаровым прошел с 10 по 17 февраля 1996 года в городе Филадельфия. Он состоял из шести партий, между которыми были дни отдыха. Deep Blue играл удалённо из Нью-Йоркской исследовательской лаборатории IBM.

В [первой партии](https://lichess.org/study/QnD0xjJc) Deep Blue играл белыми. На стандартный ход компьютера e2-e4 Гарри Каспаров сыграл [сицилианскую защиту](https://ru.wikipedia.org/wiki/Сицилианская_защита). Этот дебют он часто разыгрывал на турнирах. Такое начало навязывало белым активную игру и тактически сложные острые позиции.

Активное начало позволило Deep Blue сыграть в полную силу. Он показал высокое качество тактической игры, которое давала его огромная вычислительная мощность.

Компьютер отыграл по дебютной книге до 10-го хода. Затем на 13-ом ходу он напал на ферзя противника Nb5 (см. иллюстрацию 3-10). Одним из вариантов ответа для Гарри Каспарова был уход в глухую оборону. Но вместо этого он выбрал атаку на короля противника, чтобы не дать Deep Blue бесплатное преимущество в позиции.

{caption: "Иллюстрация 3-10. Deep Blue атакует ферзя Гарри Каспарова Nb5 на 13-ом ходу 1-й партии", height: "40%"}
![13-й ход Deep Blue в 1-й партии](images/Chess/kasparov-vs-db-1996-1st-game.png)

Обороняясь от атаки, Deep Blue успел при этом взять все незащищённые пешки на ферзевом фланге чёрных. Расчёт компьютера показывал: его фигуры успеют контратаковать ровно за один ход до того, как Каспаров поставит мат. Именно это и произошло. В результате атака чёрных захлебнулась. Гарри Каспарову пришлось сдаться из-за материального перевеса компьютера в две пешки и безнадёжной позиции.

Победа Deep Blue в первой партии вызвала сенсацию и привлекла внимание широкой публики к матчу. Посвященный матчу веб-сайт IBM стал недоступен из-за наплыва пользователей. Газета "USA Today" посвятила матчу статью на первой странице.

Играя за белых во [второй партии](https://lichess.org/study/QnD0xjJc), Гарри Каспаров учёл свои ошибки. Он имел большой опыт игры против шахматных компьютеров и знал их слабости. Одна из них — неспособность строить долгосрочные стратегические планы. Именно на этой слабости и сконцентрировался шахматист. Он применил медленный манёвренный дебют за белых, который привел к открытому [Каталонскому началу](https://ru.wikipedia.org/wiki/Каталонское_начало). Затем на 14-м ходу Гарри Каспаров сыграл новинку Nc6 (см. иллюстрацию 3-11).

{caption: "Иллюстрация 3-11. Новинка от Гарри Каспарова Nc6 на 14-ом ходу 2-й партии", height: "40%"}
![14-й ход Гарри Каспарова во 2-й партии](images/Chess/kasparov-vs-db-1996-2nd-game.png)

Идея Гарри Каспарова заключалась в том, чтобы не создавать очевидных мишеней для атаки со стороны Deep Blue. Сам же шахматист провёл атаку манёвренными фигурами — конями и ферзём. В результате компьютер получил слабую пешечную структуру, которую было сложно защищать. Такое преимущество в позиции уже гарантировало для белых ничью.

Далее Гарри Каспаров обратил внимание на предпочтения Deep Blue, запрограммированные в его оценочной функции. Одно из них — избегать размена ферзей. Команда разработчиков полагала, что сохранение ферзя увеличит тактические возможности компьютера. Но Каспаров использовал эту особенность в своих целях. Он неоднократно ставил компьютер перед выбором: размен ферзей или ухудшение позиции.

После длинного и тонкого маневра в эндшпиле Гарри Каспаров выиграл две пешки. Этого перевеса в материале было достаточно для победы. В результате Мюррей Кемпбелл, выполнявший роль оператора во второй партии, сдался на 73-м ходу.

После второй партии был день отдыха. Мюррей Кемпбелл и Джоэл Бенджамин посвятили его работе над дебютной книгой Deep Blue. Фэн Сюн Сю занимался тестированием программы и устранением обнаруженных проблем с оценочной функцией. Джо Хоэн улучшал программу и оптимизировал параллельную работу всех шахматных чипов.

В [третьей партии](https://lichess.org/study/QnD0xjJc) Deep Blue разыграл тот же дебют, что и в первой игре матча. Но на этот раз компьютер сделал новый ход, который добавил накануне Джоэл Бенджамин. Он открывал возможности для атаки на короля противника. Гарри Каспаров предвидел эту атаку и подготовился к ней. В результате Deep Blue отказался от заложенного в дебютной книге 18-го хода Be5 и сходил Rc1 (см. иллюстрацию 3.12).

{caption: "Иллюстрация 3-12. Deep Blue играет Rc1 на 18-ом ходу вместо Be5 из дебютной книги в 3-ей партии", height: "40%"}
![18-й ход Deep Blue в 3-ей партии](images/Chess/kasparov-vs-db-1996-3rd-game.png)

Планируемый ход Be5 приводил к потере белыми фигуры в сложившейся на доске позиции. Изменение плана Deep Blue дало Гарри Каспарову преимущество в позиции: у белых оказались две изолированные пешки в центре. Шахматист атаковал их. В ответ компьютер нашёл длинную цепочку хороших ходов. Это позволило разменять большинство фигур. У каждой стороны осталось по ладье и четыре пешки. Позиция оказалась равной, и стороны согласились на ничью.

В [четвёртой партии](https://lichess.org/study/QnD0xjJc) Гарри Каспаров играл белыми. Deep Blue разыграл [славянскую защиту](https://ru.wikipedia.org/wiki/Славянская_защита). Этот дебют Джоэл Бенджамин и Мюррей Кемпбелл подготовили для второй партии. Но компьютер не смог применить его раньше из-за ошибки при загрузке файла. После выхода из дебюта в четвёртой партии Deep Blue получил позицию, которую он оценил как неблагоприятную.

На 22-ходу Гарри Каспаров планировал пожертвовать коня за две пешки и возможность атаки (см. иллюстрацию 3-13). Когда компьютер должен был ответить, произошёл сбой в программе. Deep Blue пришлось перезагружать. Когда он вернулся к работе, то сыграл B×c4 вместо ожидаемого Гарри Каспаровым взятия B×f5. Этот ход привел к серии разменов, которые сравняли стороны по материалу. При этом Deep Blue оценивал свою позицию немного хуже.

{caption: "Иллюстрация 3-13. Гарри Каспаров начинает атаку на королевский фланг Deep Blue: 22-й ход в 4-й партии", height: "40%"}
![22-й ход Гарри Каспарова в 4-й партии](images/Chess/kasparov-vs-db-1996-4th-game.png)

Далее последовала серия манёвров, которые привели к размену двух пешек на ферзевом фланге. Затем на 42-ом ходу Гарри Каспаров пожертвовал ладью за сильного коня Deep Blue. Спустя несколько ходов, ему удалось создать ничейную позицию и партия закончилась.

Следующий день 15 февраля был днём отдыха. В матче сохранялся равный счёт 2-2. Команда Deep Blue продолжила работу над дебютной книгой. Джоэл Бенджамин и Мюррей Кемпбелл искали вариант, который принес бы победу за белых. Они ожидали, что Гарри Каспаров снова сыграет сицилианскую защиту за чёрных.

В [пятой партии](https://lichess.org/study/QnD0xjJc) Гарри Каспаров, вопреки ожиданиям команды Deep Blue, сыграл [русскую партию](https://ru.wikipedia.org/wiki/Русская_партия). Она также известна как защита Петрова. Из-за такого выбора шахматиста все дебютные наработки Джоэл Бенджамина, сделанные в ходе матча, оказались не востребованы. Компьютер отыграл по вариантам начал двухмесячной давности и свёл позицию в [дебют четырёх коней](https://ru.wikipedia.org/wiki/Дебют_четырёх_коней).

Защита Петрова и дебют четырёх коней относятся к спокойным началам. Для них характерны массовые размены фигур и симметричные пешечные структуры. Гарри Каспаров выбрал такой дебют, потому что не успел как следует отдохнуть между партиями. Он не был готов к острой тактической схватке с компьютером. Но именно в такой спокойной игре стали проявляться слабости оценочной функции Deep Blue.

После серии разменов в дебюте Гарри Каспаров получил небольшое преимущество в позиции на 23-ем ходу. Иллюстрация 3-14 демонстрирует позицию на доске в этот момент.

{caption: "Иллюстрация 3-14. Позиция на доске в 5-й игре, когда Каспаров предложил ничью", height: "40%"}
![23-ий ход в 5-й партии](images/Chess/kasparov-vs-db-1996-5th-game.png)

После этого хода шахматист предложил ничью. Он хотел сохранить силы для своей завтрашней игры белыми на победу. После совещания с командой Фен Сюн Сю отклонил предложение и продолжил игру. Это решение стало переломным моментом в матче.

Уже следующим ходом Qc3 Deep Blue совершил ошибку, связав своего ферзя и коня. Гарри Каспаров тем временем начал продвигать вперёд свои пешки. Компьютер не понимал слабости своей позиции и не видел хорошего продолжения. Он сделал несколько бессмысленных ходов ферзём и ладьёй, пока Каспаров концентрировал силы для поддержки проходной пешки на вертикали e. Её удалось провести и в результате размена шахматист выиграл материал. Этого оказалось достаточно для победы.

Пятая партия дала Гарри Каспарову важную информацию о слабых сторонах Deep Blue. Все они сводились к ошибкам оценочной функции. Шахматист почувствовал уверенность в своих силах и хорошо продумал свою стратегию для последней партии.

Для [шестой партии](https://lichess.org/study/QnD0xjJc) Мюррей Кемпбелл и Джоэл Бенджамин подготовили дебютный вариант, который позволял чёрным сыграть на победу. Они выбрали один из хорошо проработанных вариантов в дебютной книге Deep Blue — славянской защите.

Играя за белых, Гарри Каспаров намеренно изменил порядок ходов в начале партии. Тем самым он вывел Deep Blue из дебютной книги. В отличие от человека компьютер не понимал, что в определённых дебютах фигуры должны встать на определённые поля. При этом последовательность ходов неважна. Глубокий поиск мало помогал Deep Blue в начале партии. В результате он сделал ряд слабых ходов и получил пассивную позицию.

Гарри Каспаров последовательно продвигал пешки на ферзевом фланге. В итоге фигуры Deep Blue оказались зажаты и только мешали друг другу. Последнюю серьёзную ошибку компьютер совершил на 30-м ходу, когда заблокировал свою ладью слоном. Иллюстрация 3-15 демонстрирует этот ход.

{caption: "Иллюстрация 3-15. Последняя серьёзная ошибка Deep Blue в 6-й партии: 30-й ход Bb8", height: "40%"}
![30-й ход Deep Blue в 6-й партии](images/Chess/kasparov-vs-db-1996-6th-game.png)

Дальше последовал размен фигур. Он привёл к положению чёрных, которое называется [**цугцванг**](https://ru.wikipedia.org/wiki/Цугцванг). В такой позиции любой ход ведёт к потере материала или мату. Тогда команда Deep Blue решила сдаться. Гарри Каспаров одержал уверенную победу в матче со счётом 4-2.

В первых четырёх партиях матча Deep Blue удалось отыграть заранее подготовленные дебюты. Это предотвратило очевидные позиционные ошибки с его стороны. Но в двух последних партиях Гарри Каспаров сумел вывести компьютер из хорошо проработанных дебютных вариантов. Он нащупал недостатки в игре оппонента и умело их использовал. У команды Deep Blue не было достаточно времени и технических средств, чтобы исправить ошибки компьютера.

#### 3.5.3.4 Версия Deep Blue 1997 года

Первый матч Deep Blue с Гарри Каспаровым указал разработчикам на слабые стороны компьютера. Несмотря на поражение, Фэн Сюн Сю и его коллеги были настроены оптимистично. У них были идеи, как сделать игру Deep Blue сильнее.

Прежде всего, матч показал, что производительности компьютера достаточно для игры на высшем уровне. Ему не хватало общих знаний по шахматной теории. Из-за этого Deep Blue плохо различал тонкие преимущества некоторых ходов в спокойных позициях. Как следствие, его стратегическая игра была слабой. Гарри Каспаров выигрывал партии именно стратегически, а не тактически.

Второй проблемой был дефицит времени для разработки управляющей программы. В первой партии чипов от VLSI Technology обнаружились аппаратные ошибки. Компании потребовалось время, чтобы их исправить и прислать новую партию. В результате разработчики получили рабочие чипы слишком поздно. У них не осталось времени, чтобы включить в управляющую программу все аппаратные признаки оценки.

Третья проблема заключалась в особенностях многодневного матча. Все предыдущие соревнования с участием Deep Thought и ChipTest проходили за один день. Команда разработчиков никогда раньше не играла крупный матч с одним соперником. Отсутствие опыта привело к нескольким проблемам. Во-первых, когда Гарри Каспаров предложил ничью в пятой партии, команда потратила слишком много игрового времени на её обсуждение. Во-вторых, не было удобных инструментов, чтобы устранять обнаруженные проблемы и быстро вносить изменения в работу Deep Blue в ходе матча. Гарри Каспаров адаптировался к игре своего оппонента, а Deep Blue такой возможности не имел.

Нужен ли Deep Blue новый шахматный чип? Это был первый вопрос, который обсуждала команда после возвращения к работе. На необходимости в этом настаивал Фэн Сюн Сю и ему удалось убедить коллег.

Во время матча с Гарри Каспаровым компьютер неоднократно делал бессмысленные ходы. Детектор повторений позиций на аппаратном уровне мог бы их предотвратить. Но из-за нехватки времени его реализовали только в программе управляющего компьютера. Программный детектор проверял позиции только на очень ограниченной глубине дерева игры. Из-за этого Deep Blue повторял позиции, которые ему нравились, как только они оказывались за горизонтом программного детектора повторений.

Новый шахматный чип получил также полностью переработанную оценочную функцию. Она учитывала больше факторов позиции, чем прошлая версия. Ещё одним улучшением стал новый генератор ходов. Он отсекал заведомо плохие варианты, что увеличило аппаратную скорость поиска в 5-10 раз.

У оценочной функции нового чипа был программный прототип. Он помогал Фэн Сюн Сю при проектировании. Мюррей Кэмпбелл добавил к этому прототипу графический интерфейс. В результате получилось полноценное приложение для анализа шахматных позиций. Именно этот новый инструмент помог Джоэлу Бенджамину обнаружить проблему Deep Blue с контролем вертикальных линий. Компьютер правильно оценивал открытые вертикали и старался контролировать их своими ладьями. Но он не понимал важность закрытых вертикалей, которые можно было вскрыть ходом своей пешки. Deep Blue совершал ту же ошибку в отношении закрытых диагоналей и слонов. Именно она усугубила позицию в шестой партии с Гарри Каспаровым и привела к поражению.

Другой обнаруженной проблемой была переоценка безопасности короля. Deep Blue предпочитал защищать короля другими фигурами в течении всей партии. Джоэл Бенджамин поменял приоритет этой цели в зависимости от стадии игры и позиции. В дебюте и миттельшпиле компьютер всё так же уделял внимание защите короля. Но в эндшпиле его поведение изменилось. Теперь Deep Blue предпочитал активно использовать короля в конце партии наравне с другими фигурами.

Джоэл Бенджамин тщательно тестировал программу Deep Blue в ежедневных партиях. К этому моменту команда ещё не получила новые шахматные чипы. Поэтому гроссмейстер играл с Deep Blue Junior. Это была версия управляющей программы, адаптированная для персонального компьютера. Даже без шахматных чипов программа играла на уровне 2600 Эло. Поэтому чтобы тестирование шло продуктивнее, Джоэл Бенджамин брал ходы назад и исправлял свои ошибки. Так он снова и снова возвращался к позициям, где у него были шансы на победу. В результате ему удалось найти много ситуаций, в которых Deep Blue Junior ошибался и действовал неправильно.

Мюррей Кэмпбелл и Джо Хоэн получали информацию об ошибках Deep Blue Junior и вносили изменения в оценочную функцию. В результате программа управляющего компьютера Deep Blue гораздо точнее и быстрее оценивала позиции. В этом ей также помогали аппаратные признаки оценки чипа, которые не работали в матче 1996 года.

Когда VLSI Technology прислала первую партию шахматных чипов, разработчики установили один из них на Deep Blue Junior. Скорость поиска системы составила от 100000 до 300000 позиций в секунду. Deep Blue Junior сыграл с лучшими коммерческими шахматными программами, доступными на тот момент для персональных компьютеров. Их скорость поиска была примерно на том же уровне. Главное преимущество Deep Blue Junior заключалось в оценочной функции. Компьютер выиграл 10 партий и не проиграл ни одной. Это означало, что он минимум на 200 очков Эло превосходил коммерческие программы.

Для следующей пробной игры команда пригласила известного испанского шахматиста Мигеля Ильескаса. Он участвовал в турнирах того же уровня, что и Гарри Каспаров. Чтобы усилить Deep Blue Junior, к нему подключили ещё несколько шахматных чипов. Компьютер одолел гроссмейстера в большей части игр. Но шахматист обнаружил проблемы в оценочной функции и рассказал о них. После этого он провёл две недели в лаборатории IBM, работая вместе с Джоэлом Бенджамином над дебютной книгой для Deep Blue.

В финальном тестировании Deep Blue Junior играл матчи против двух гроссмейстеров: Ларри Кристиансена и Майкла Роде. Каждый матч состоял из двух партий и проходил с классическим контролем времени. Deep Blue Junior обыграл обоих гроссмейстеров со счётом 1,5-0,5. Эти результаты показали, что уровень Эло компьютера примерно соответствует уровню Гарри Каспарова.

Второй матч из шести партий между Гарри Каспаровым и новым Deep Blue прошел с 3 по 11 мая 1997 году в Нью-Йорке. На этот раз компьютер перевезли и собрали в здании Equitable Building на острове Манхэттен, где и проходил матч. Рекламная компания IBM подогрела общественный интерес и привлекла к этому событию повышенное внимание.

Команда Deep Blue держала информацию обо всех улучшениях Deep Blue в секрете. Поэтому у Гарри Каспарова не было возможности как следует подготовиться к предстоящему матчу. Одно он знал наверняка: ему предстоит играть против совершенно другого компьютера. В нём не будет недостатков, которые позволили шахматисту выиграть год назад. Поэтому Гарри Каспаров решил использовать первые партии для исследования слабых сторон оппонента. Для этого он играл пассивно, пытаясь создать на доске спокойные позиции. В таких положениях Deep Blue не мог вести тактическую игру, которая была его главной сильной стороной.

В [первой партии](https://lichess.org/study/1tjS4Wyd/eSWarjHL) матча Гарри Каспаров играл белыми. Он выбрал [дебют Рети](https://ru.wikipedia.org/wiki/Дебют_Рети) с двумя фианкетированными слонами. После первых девяти ходов стороны пришли к хорошо известной закрытой позиции (см. иллюстрацию 3-16). Именно к такому положению стремился Гарри Каспаров. Он полагал, что Deep Blue по-прежнему слаб в стратегическом планировании. Поэтому спокойные позиции должны были спровоцировать компьютер на ошибки.

{caption: "Иллюстрация 3-16. Каспаров выводит Deep Blue из дебютной книги 10-ым ходом e3 в 1-й партии", height: "40%"}
![10-й ход Гарри Каспарова в 1-й партии](images/Chess/kasparov-vs-db-1997-1st-game-10-turn.png)

Каспаров ожидал, что эта позиция есть в дебютной книге Deep Blue. Поэтому он сыграл нестандартный выжидательный 10-й ход пешкой e3 (см. иллюстрацию 3-16). В такой ситуации у компьютера не было конкретной цели для атаки. Он сделал посредственный ход пешкой h6 и тем самым ослабил защиту своего короля.

Гарри Каспаров сделал еще два пассивных хода. В ответ на них Deep Blue вывел своего ферзя Qa5 и сам же отрезал ему путь назад слоном Bc7. Далее шахматист сделал несколько манёвров, а Deep Blue продолжал ошибаться. В результате к 15-ому ходу компьютер получил слабую пешечную структуру, которую было трудно защитить.

Осторожная игра Гарри Каспарова обернулась против него самого. Он не мог извлечь преимущества из слабых ходов Deep Blue. Шахматист не хотел торопиться и контратаковать, поскольку опасался сильной тактической игры компьютера. Это промедление привело к тому, что Deep Blue нашёл несколько сильных ходов. Он атаковал до того, как Гарри Каспаров подготовился к обороне. Иллюстрация 3-17 демонстрирует атаку Deep Blue dxe4 центральными пешками на 19-ом ходу.

{caption: "Иллюстрация 3-17. Атака Deep Blue dxe4 центральными пешками на 19-ом ходу в первой партии", height: "40%"}
![19-й ход Deep Blue в 1-й партии](images/Chess/kasparov-vs-db-1997-1st-game-19-turn.png)

Атака компьютера привела к неравному размену материала на 30-м ходу: слон за ладью в пользу Deep Blue. Гарри Каспаров в обмен на материал получил лучшую позицию. Его две связанные пешки на вертикалях f и g стали проходными.

Далее Deep Blue пошел на размен ферзей. Он стремился свести партию к эндшпилю, поскольку считал свою позицию выигрышной из-за преимущества в материале. Это оказалось ошибкой. На самом деле позиция компьютера была хуже. Кроме того инициатива была на стороне Гарри Каспарова: Deep Blue предстояло защищаться от атаки его проходных пешек. Без ферзя это было очень сложно сделать.

У Deep Blue ещё оставался шанс на ничью. На 36-ом ходу у него был вариант Ng4 и размен коней. Так он лишал Гарри Каспарова необходимого материала для атаки на королевский фланг. Компьютер решил не разменивать фигуры. В результате успешная атака шахматиста завершила партию в его пользу.

Результат первой партии удовлетворил обе стороны. Команда Deep Blue получила новую информацию об ошибках в оценочной функции. Их исправлением занялся Джо Хоэн. Разработчики считали, что теперь осторожная стратегия не работает против компьютера.

Гарри Каспаров рассматривал эту партию как третью победу подряд над Deep Blue. Это придало ему уверенности в своих силах. Старые способы провоцировать компьютер на слабые ходы и откровенные ошибки ещё работали. Шахматист высоко оценивал свои шансы на победу, если матч будет продолжаться в том же духе.

Во [второй партии](https://lichess.org/study/1tjS4Wyd/eSWarjHL) матча Гарри Каспаров играл чёрными. Он решил, что пассивная стратегия в этот раз слишком рискованна. Играя за белых, Deep Blue получал инициативу. Предыдущая партия показала, насколько хорошо он умеет атаковать и навязывать размен фигур. Осторожная игра чёрными против компьютера могла привести к открытой позиции. В ней Deep Blue был тактически сильнее шахматиста.

Гарри Каспаров выбрал хорошо известный дебют под названием [испанская партия](https://ru.wikipedia.org/wiki/Испанская_партия). Он рассчитывал свести игру к закрытой позиции, в которой Deep Blue не сможет найти чёткий план действий и потеряет темп. Тогда шахматист мог перехватить контроль за развитием партии и повернуть её в нужное русло. В случае неудачи этого плана, он надеялся добиться ничьей.

План Гарри Каспарова на дебют удался. Deep Blue на 16-ому ходу пешкой d5 заблокировал центр (см. иллюстрацию 3-18). На доске сложилась неоднозначная закрытая позиция. С одной стороны, такие положения фигур особенно трудны для анализа компьютером. С другой стороны, Deep Blue имел значительное преимущество в пространстве. Его фигуры свободно перемещались между флангами, в то время как фигуры Гарри Каспарова были зажаты и не имели такой манёвренности.

{caption: "Иллюстрация 3-18. Deep Blue блокирует центр на 16-ом ходу во второй партии", height: "40%"}
![16-й ход Deep Blue во 2-й партии](images/Chess/kasparov-vs-db-1997-2nd-game-16-turn.png)

Центральные пешки оказались заблокированными. Но на ферзевом фланге оставалась возможность вскрыть пешечную цепь. Deep Blue усилил давление на этот флаг ходом ладьи Rec1. В ответ Гарри Каспаров заблокировал и ферзевой фланг, сыграв на 24-ом ходу пешкой c4 (см. иллюстрацию 3-19).

{caption: "Иллюстрация 3-19. Гарри Каспаров блокирует ферзевой фланг на 24-ом ходу во второй партии", height: "40%"}
![24-й ход Гарри Каспарова во 2-й партии](images/Chess/kasparov-vs-db-1997-2nd-game-24-turn.png)

Вопреки ожиданиям, Deep Blue повёл себя совершенно иначе чем в первой партии. Вместо бесцельных ходов, он начал готовить прорыв на ферзевом фланге. Для этого он сдвоил свои ладьи на вертикали a, планируя в дальнейшем вскрыть её взятием пешки axb5. Такими действиями компьютер связал тяжёлые фигуры Гарри Каспарова на ферзевом фланге.

Далее 26-м ходом Deep Blue атакой пешки открыл второй фронт на королевском фланге (см. иллюстрацию 3-20). Эта атака позволила вскрыть центральные вертикали d и e, а также разменять лёгкие фигуры.

{caption: "Иллюстрация 3-20. Deep Blue открывает второй фронт 26-ым ходом во второй партии", height: "40%"}
![26-й ход Deep Blue во 2-й партии](images/Chess/kasparov-vs-db-1997-2nd-game-26-turn.png)

В результате разменов, у Deep Blue появилось две возможности: 

1. Проникнуть ферзём за пешечную цепь чёрных 36-ым ходом Qb6.

2. Вскрыть вертикаль a и атаковать ферзевой фланг противника своими сдвоенными ладьями.

Гарри Каспаров и комментаторы ожидали от компьютера атаку ферзём Qb6. Так он выигрывал две пешки, но взамен шахматист получал шанс на контратаку в центре. Вопреки прогнозам, Deep Blue предпочёл второй вариант и провёл атаку ладьями на ферзевом фланге. В результате стороны обменялись ладьями. На 45-м ходу сложилась позиция, в которой Гарри Каспаров сдался (см. иллюстрацию 3-21).

{caption: "Иллюстрация 3-21. Финальный 45-й ход Deep Blue во второй партии", height: "40%"}
![45-й ход Deep Blue во 2-й партии](images/Chess/kasparov-vs-db-1997-2nd-game-45-turn.png)

Гарри Каспаров считал эту позицию безвыходной. Размен ферзями давал Deep Blue возможность провести пешку по вертикали c. Шахматист не видел, как её надёжно заблокировать. С другой стороны, отказ от размена ферзями приводил к потере слона. За это чёрные могли дать несколько шахов королю белых. Гарри Каспаров был уверен, что Deep Blue просчитает все ходы и предотвратит ничью в результате троекратного повторения позиции. В этом он ошибся.

Шахматное сообщество проанализировало дальнейшее развитие партии. На следующий день на сайте "The Week In Chess" появился детальный анализ. Из него следовало, что последний 45-й ход Deep Blue Ra6 был ошибкой. Он позволял чёрным вывести ферзя за пешечную цепь белых ходом Qe3 и начать серию шахов. Тогда лучшая игра с обеих сторон приводит к повторению позиции и ничьей.

Новость об упущенной ничьей быстро разлетелась благодаря СМИ. Её постоянно обсуждали, в том числе в присутствии Гарри Каспарова. Это подорвало уверенность шахматиста в своих силах. Она начал сомневаться, что выбрал правильную стратегию на матч.

Чтобы оправиться от тяжёлого поражения, профессиональные игроки стараются свести следующую партию матча к быстрой ничьей. К сожалению, Гарри Каспаров не мог себе этого позволить. У него оставалось только две партии за белых при равном счёте 1-1 в матче. Обе из них он должен был играть на победу.

В [третьей партии](https://lichess.org/study/1tjS4Wyd/eSWarjHL) матча Гарри Каспаров играл белыми. Он решил придерживаться осторожной стратегии, как и в первой партии. Первым ходом пешкой d3 он попытался сразу вывести Deep Blue из дебютной книги. При этом шахматист мог свести позицию к нескольким стандартным дебютам, просто поменяв порядок ходов.

Deep Blue в дебюте тоже сыграл осторожно. В результате после 5-го хода Гарри Каспарова Nc5 позиция перешла в известную линию [английского начала](https://ru.wikipedia.org/wiki/Английское_начало) (см. иллюстрацию 3-22). Считается, что такой дебют не даёт белым особых шансов получить преимущество в начале миттельшпиля.

{caption: "Иллюстрация 3-22. Позиция на доске после 5-го хода Гарри Каспарова в 3-ей партии", height: "40%"}
![5-й ход Гарри Каспарова в 3-ей партии](images/Chess/kasparov-vs-db-1997-3rd-game-5-turn.png)

Deep Blue делал посредственные ходы. Гарри Каспаров отказался от наступления на ферзевом фланге, которое было типично для выбранного им начала. Из-за этого белые не получили какого-либо значимого преимущества при выходе из дебюта.

На 14-ом ходу Deep Blue заблокировал все центральные пешки белых. К этому моменту у Гарри Каспарова было небольшое преимущество в мобильности фигур. Его могла бы реализовать атака на одном фланге и открытие второго фронта на другом. Тогда белые фигуры смоги бы поддержать новое направление атаки, а чёрные не успели бы вовремя построить оборону. Возможно, этим планом руководствовался Гарри Каспаров, когда на 15-ом ходу атаковал пешкой на ферзевом фланге (см. иллюстрацию 3-23).

{caption: "Иллюстрация 3-23. Атака Гарри Каспарова на ферзевом фланге на 15-ом ходу в 3-ей партии", height: "40%"}
![15-й ход Гарри Каспарова в 3-ей партии](images/Chess/kasparov-vs-db-1997-3rd-game-15-turn.png)

Атака Гарри Каспарова вскрыла вертикаль b, которую контролировала его ладья. Далее шахматист провёл атаку пешкой и слоном на королевском фланге. Целью этой атаки был белопольный чёрный слон. Его удалось запереть на поле h7 и вывести из игры. За это Гарри Каспарову пришлось пожертвовать пешку на вертикали a.

На 24-ходу у шахматиста было два варианта: вторгнуться ладьей за пешечную цепь чёрных по открытой вертикали b или навязать размен ферзей. Вторжение ладьи не дало бы значительного преимущества, но сделало бы игру более активной. Именно такой стиль предпочитал Гарри Каспаров в партиях с другими шахматистами. Но против компьютера было опасно так поступать. Вместо этого шахматист сыграл осторожно и разменял ферзей на 25-ом ходу.

Вывод белопольного слона чёрных из игры давал Гарри Каспарову преимущество. Он атаковал центр четырьмя лёгкими фигурами. В то время как у Deep Blue активными были только два коня. Этим давлением шахматист пытался заманить Deep Blue в пассивную оборонительную позицию. Но компьютер просчитал недостатки такого развития событий и сумел сохранить мобильность своих фигур.

Атака Каспарова привела к размену всех лёгких фигур кроме двух белопольных слонов. Шахматист сумел отыграть потерянную ранее пешку. Но в обмен на пешку Deep Blue создал [крепость](https://ru.wikipedia.org/wiki/Крепость_(шахматы)) на 42-ом ходу (см. иллюстрацию 3-24). Это ничейная позиция, в которой сильная сторона не может проникнуть на территорию обороняющегося. В результате на 48-ом ходу Гарри Каспаров предложил ничью.

{caption: "Иллюстрация 3-24. Deep Blue создаёт крепость на 42-ом ходу в 3-ей партии", height: "40%"}
![42-й ход Deep Blue в 3-ей партии](images/Chess/kasparov-vs-db-1997-3rd-game-42-turn.png)

После третьей партии счёт в матче оставался равным 1,5-1,5. Эта спокойная игра не смогла отвлечь публику от разговоров о преждевременной сдачи Гарри Каспарова во второй партии. Шахматист попробовал сменить тему обсуждений. После третий партии состоялась пресс-конференция. На ней Гарри Каспарова обвинил IBM в нечестной игре. Команда разработчиков предоставила протокол второй партии Кену Томпсону, который состоял в апелляционном комитете. Это решило проблему и матч продолжился.

В [четвёртой партии](https://lichess.org/study/1tjS4Wyd/eSWarjHL) настала очередь Deep Blue играть белыми. В ответ на стандартный 1-й ход компьютера e2-e4 Гарри Каспаров сыграл [защиту Каро-Канн](https://ru.wikipedia.org/wiki/Защита_Каро_—_Канн). Шахматист решил и дальше следовать осторожной стратегии, поэтому он выбрал полуоткрытый дебют. При этом Гарри Каспаров продолжал попытки запутать Deep Blue в дебюте. Он сыграл второй нестандартный ход пешкой d6 вместо d5.

В ответ на такое начало Deep Blue занял центр пешками на вертикалях d и e, а после вывел обоих коней. Его фигуры заняли позицию, к которой приводит шотландский вариант [дебюта четырёх коней](https://ru.wikipedia.org/wiki/Дебют_четырёх_коней).

Deep Blue играл в дебюте активно и навязывал размены фигур. В результате стороны обменялись обоими слонами. Кроме этого компьютер выдвинул вперёд пешки на королевском фланге, но без какого либо продолжения. Тем самым он создал слабость в своей позиции.

20-ым ходом e5 Гарри Каспаров предложил жертву центральной пешки (см. иллюстрацию 3-25). Deep Blue принял жертву dxe5. В результате фигуры чёрных получили пространство для манёвра.

{caption: "Иллюстрация 3-25. Гарри Каспаров жертвует пешку на 20-ом ходу в 4-й партии", height: "40%"}
![20-й ход Гарри Каспарова в 4-й партии](images/Chess/kasparov-vs-db-1997-4th-game-20-turn.png)

Гарри Каспаров попробовал занять центр своими конями. В ответ Deep Blue начал продвигать пешки на ферзевом фланге. На 27-ом ходу шахматист навязал размен ферзей. Его фигуры были более активны, и в целом их позиция выглядела лучше. За разменом последовала атака чёрных ладей по открытой вертикали f на 33-ем ходу (см. иллюстрацию 3-26). Она позволила Гарри Каспарову отыграть пешку и сравнять материал. Далее стороны разменялись обоими конями. Позиция свелась к [ладейному окончанию](https://ru.wikipedia.org/wiki/Ладейные_окончания).

{caption: "Иллюстрация 3-26. Атака Гарри Каспарова ладьями на 33-ем ходу в 4-й партии", height: "40%"}
![33-й ход Гарри Каспарова в 4-й партии](images/Chess/kasparov-vs-db-1997-4th-game-33-turn.png)

Расположения пешек у Deep Blue было хуже: они были изолированы и уязвимы. Компьютер имел специальные знания и базу данных по ладейным окончаниям. Используя эту информацию, он отыграл лучшие ходы и сумел свести партию к ничьей. Счёт в матче оставался равным 2-2.

После четвёртой партии было два дня отдыха. Команда Deep Blue занялась исправлением ошибок в оценочной функции. Фэн Сюн Сю считал, что они — причина всех плохих ходов компьютера. Разработчики подготовили большой набор тестовых позиций. Deep Blue оценивал каждую из них и предлагал лучший ход. Слабые ходы указывали на ошибку в оценочной функции. Её соответствующим образом исправляли.

В [пятой партии](https://lichess.org/study/1tjS4Wyd/PPnu8omn) Гарри Каспаров играл белыми в последний раз. Ему обязательно нужна была победа. В следующей партии за чёрных у него было мало шансов выиграть Deep Blue. Шахматист решил повторить начало из первой партии матча — дебют Рети.

В отличие от первой партии Гарри Каспаров сделал третий ход слоном Bg2 вместо пешки b3. Далее на четвёртом ходу Deep Blue разменял своего слона на коня ходом Bxf3. Так компьютер получил немного лучшее развитие фигур. Началась борьба за центр, которая привела к размену пешками: по одной с каждой стороны.

На 11-ом ходу Deep Blue неожиданно выдвинул пешку по вертикали h на два поля вперёд (см. иллюстрацию 3-27). Так он создал угрозу на королевском фланге белых, и заставил Гарри Каспарова задуматься над рокировкой на ферзевом фланге. Последующий анализ партии показал, что ход Deep Blue h5 был посредственным. Гарри Каспаров мог воспользоваться им и получить лучшую позицию. Но шахматист этого не сделал.

{caption: "Иллюстрация 3-27. Deep Blue выдвигает пешку h5 на 11-ом ходу 5-й партии", height: "40%"}
![11-й ход Deep Blue в 5-й партии](images/Chess/kasparov-vs-db-1997-5th-game-11-turn.png)

К 20-ому ходу оба короля рокировались на ферзевом фланге. После этого Deep Blue навязал размен. Каждая сторона лишилась одного слона и ладьи. Гарри Каспаров оценивал позицию как примерно равную. Далее на 29-ом ходу компьютер предложил размен ферзей (см. иллюстрацию 2-28). Шахматист посчитал это ошибкой и согласился на размен. Это ослабило защиту чёрных пешек, которые уже имели слабую структуру.

{caption: "Иллюстрация 3-28. Deep Blue предлагает размен ферзей 29-ом ходу 5-й партии", height: "40%"}
![29-й ход Deep Blue в 5-й партии](images/Chess/kasparov-vs-db-1997-5th-game-29-turn.png)

Гарри Каспаров разменял своего слона на коня и успешно атаковал чёрные пешки на королевском фланге. Так он расчистил путь своей проходной пешке на вертикали g. У чёрных не было никакой возможности её остановить. Но вместо борьбы с проходной пешкой Deep Blue атаковал белого короля. Это вынудило Гарри Каспарова согласиться на ничью из-за скорого троекратного повторения позиции (см. иллюстрацию 2-29).

{caption: "Иллюстрация 3-29. Последний ход Deep Blue в 5-й партии", height: "40%"}
![49-й ход Deep Blue в 5-й партии](images/Chess/kasparov-vs-db-1997-5th-game-49-turn.png)

Перед заключительной [шестой партией](https://lichess.org/study/1tjS4Wyd/eSWarjHL) матча счёт оставался равным 2,5-2,5. Deep Blue предстояло играть белыми. Команда разработчиков ожидала как минимум ничьей в этой партии и матче.

Гарри Каспаров выбрал защиту Каро-Канн как и в четвёртой партии. Только на этот раз он следовал главной линии начала. Deep Blue тоже отыгрывал главную линию по своей дебютной книге.

На 7-ом ходу Гарри Каспаров отклонился от дебютной книги. Вместо стандартного хода слоном Bd6 он напал пешкой на коня белых h6 (см. иллюстрацию 3-30). Это был рискованный ход. Если в ответ на него Deep Blue отводит коня, чёрные получают лучшую позицию. Гарри Каспаров готовил этот ход и тестировал его на нескольких коммерческих шахматных программах. Все они уводили коня, поскольку считали жертву материала за возможность сильной атаки невыгодной.

{caption: "Иллюстрация 3-30. Гарри Каспаров атакует коня белых на 7-ом ходу 6-й партии", height: "40%"}
![7-й ход Гарри Каспарова в 6-й партии](images/Chess/kasparov-vs-db-1997-6th-game-7-turn.png)

Вопреки ожиданиям, Deep Blue пожертвовал коня ходом Nxe6. Его дебютная книга отличалась от тех, которыми пользовались коммерческие шахматные программы. Готовившие её гроссмейстеры верили, что компьютер сможет развить атаку. Поэтому в сложившейся позиции они добавили жертву коня ходом Nxe6.

Только на 11-ом ходу Deep Blue вышел из своей дебютной книги. Его оценка позиции показывала преимущество в одну пешку, хотя фактически он разменял коня на пешку. Компьютер получил инициативу и знал это.

Deep Blue отказался от возможного выигрыша материала и развивал атаку на короля чёрных. Для этого он выдвинул пешку a4. Тем самым он пытался разорвать пешечную цепь на ферзевом фланге, где укрывался король чёрных.

На 18-ом ходу Deep Blue разменял ладью и слона на чёрного ферзя. Следующим ходом компьютер атаковал пешками ферзевой фланг. Эта атака приносила выигрыш материала. Гарри Каспаров предвидел это и отчётливо понимал безнадёжность своей позиции. Он сдался на 19-ом ходу (см. иллюстрацию 3-31). Deep Blue выиграл матч со счётом 3,5-2,5.

{caption: "Иллюстрация 3-31. Последний ход Deep Blue в 6-й партии", height: "40%"}
![19-й ход Deep Blue в 6-й партии](images/Chess/kasparov-vs-db-1997-6th-game-19-turn.png)

На пресс-конференции после матча Гарри Каспаров высказал претензии к IBM. Он обвинил компанию в нечестной игре и утверждал, что некоторые ходы за Deep Blue делал гроссмейстер. Причиной для подозрений стала неровная игра компьютера. Иногда за плохим ходом Deep Blue следовал очень хороший и наоборот.

IBM представила распечатки log-файлов. Они показали, что Deep Blue делал все ходы сам. Фэн Сюн Сю подробно описал историю Deep Blue в своей книге "Behind Deep Blue". Он объяснил, что ошибки в оценочной функции приводили к слабым ходам компьютера. Некоторые из аппаратных признаков оценки имели некорректные веса. Поэтому Deep Blue неправильно понимал позицию и принимал плохие решения. Во время тестирования эти позиции просто не появлялись на доске. Так ошибки компьютера оставались необнаруженными.

Гарри Каспаров настаивал на проведении матча-реванша, но IBM отклонила это предложение. Победа Deep Blue стала отличным маркетинговым ходом. Она укрепила репутацию IBM среди инвесторов. Вопреки утверждениям Гарри Каспарова и других источников матч мало повлиял на стоимость акций компании. С другой стороны, IBM инвестировала в проект Deep Blue несколько миллионов долларов. Матч-реванш потребовал бы дальнейших крупных вложений, но не принёс бы выгоды. Поражение Deep Blue вызвало бы сомнения: действительно ли компьютер играет сильнее чемпиона мира по шахматам? Следившие за матчем опытные шахматисты утверждали, что силы сторон были примерно равны.

Через 20 лет после матча Гарри Каспаров написал книгу "Человек и компьютер: взгляд в будущее". В ней он признал: Deep Blue играл честно и делал все ходы сам. Но у шахматиста всё равно остались претензии к тому, как был организован матч.

### 3.5.4 ПК как платформа

В конце 1990-х годов шахматные программы для ПК приблизились к гроссмейстерскому уровню игры. Это произошло по нескольким причинам. Во-первых, выросла вычислительная мощность самих компьютеров. Большая их часть строилась на [IBM-совместимой](https://ru.wikipedia.org/wiki/IBM-PC-совместимый_компьютер) архитектуре и работала на процессорах от компании Intel. В 1993 году вышел первый процессор серии [Intel Pentium](https://ru.wikipedia.org/wiki/X86#Процессоры_Intel). К концу 1990-х его конструкция была усовершенствована. Так ПК с доступной ценой получили мощный и недорогой процессор. Его производительность позволила шахматным программам просчитывать ходы на глубину, достаточную для качественной игры.

Во-вторых, развивались сами шахматные программы. Основные усовершенствования касались оценочной функции. Благодаря им, программы стали лучше понимать позиции и выбирать более сильные ходы. Появились новые эвристики поиска. С их помощью программы пропускали больше бесперспективных ходов и глубже просчитывали перспективные. Улучшались также и методы генерации ходов.

В-третьих, распространение ПК сделало шахматные программы доступными для любителей и профессионалов. Между программами проводились частые соревнования. Всё это привело к их более интенсивному использованию и, как следствие, лучшему тестированию. Ошибки кодирования стали выявлять и исправлять быстрее чем раньше.

Основной платформой для шахматных программ стали ПК. Компании и разработчики-энтузиасты перестали проектировать специальные шахматные чипы и компьютеры. Они оказались слишком дороги и недоступны для широкой массы пользователей. Все новейшие разработки сконцентрировались на программах для ПК.

### 3.5.5 Шахматные движки

В начале 1990-х годов появилось много шахматных программ разного уровня. Некоторые из них позиционировались как игры для детей и любителей. Другие были инструментами для профессиональных шахматистов. Чтобы различать эти две категории, в 1993 году программист [Мартин Хирш](https://www.chessprogramming.org/Marty_Hirsch) ввёл термин шахматный движок. [**Шахматный движок**](https://ru.wikipedia.org/wiki/Шахматный_движок) — это программа, которая анализирует заданную позицию и генерирует для неё список лучших ходов. Именно так стали называть инструменты для профессионалов.

Первые шахматные игры для ПК появились в конце 1980-х годов. К ним относятся, например, [Chessmaster](https://en.wikipedia.org/wiki/Chessmaster) и [Battle Chess](https://en.wikipedia.org/wiki/Battle_Chess). Эти программы имеют красивый по меркам своего времени графический интерфейс. В Battle Chess после каждого хода фигуры оживают и перемещаются на указанное поле доски. Если это поле уже занимает фигура противника, происходит красочное сражение. Шахматные игры предназначаются для широкой аудитории. Они продаются по низкой цене и позиционируются как развлечения. Обычно они играют на любительском уровне порядка 1600 пунктов Эло.

В отличие от игр, у шахматных движков нет графического интерфейса. Это инструменты для глубокого анализа указанной позиции. Они предлагают перспективные варианты для делающего ход игрока и возможные ответы противника. Пользователь работает с такой программой через интерфейс командной строки. С помощью этого инструмента шахматисты готовятся к турнирам. Они анализируют свои сыгранные ранее партии и партии будущих оппонентов, находят ошибки в своих действиях, ищут новинки в известных дебютах. Цена на шахматные движки высока, как и на любой профессиональный инструмент. Их уровень игры превышает гроссмейстерский.

Интерфейс командной строки был неудобен для большинства пользователей. Поэтому в начале 1990-х стали появляться программы для визуализации работы шахматного движка. Большинство современных программ визуализации коммерческие и достаточно дорогие. При этом наиболее сильные шахматные движки сегодня бесплатны и распространяются с [открытым исходным кодом](https://ru.wikipedia.org/wiki/Свободное_и_открытое_программное_обеспечение). Некоторые современные шахматные игры используют шахматный движок для выбора ходов. Так они усиливают свою игру до профессионального уровня.

{pagebreak}
