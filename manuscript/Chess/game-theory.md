## Теория игр и шахматы

### Классификация игры

Для начала определим, к какому классу стратегических игр относятся [шахматы](https://ru.wikipedia.org/wiki/Шахматы). Для этого обратимся к таблице 1-1 и пройдём по каждому признаку.

Первый признак — это порядок ходов. В шахматах участники ходят по очереди друг за другом. Поэтому шахматы — это последовательная игра.

Выигрыш одного игрока означает поражение другого. По правилам шахматных турниров выигравший партию игрок получает одно очко, а проигравший ноль. В партии возможна ничья. При этом игроки делят выигрыш пополам: каждый получает по 0.5 очков. Из этих правил следует, что шахматы — это игра с нулевой суммой.

В шахматах правила игры являются общим знанием. Каждый участник знает правила игры, выигрыши при возможных исходах и функции полезности. Игроки знают стратегии друг друга потому, что могут просчитать несколько ходов наперёд. Таким образом шахматы — это игра с полной информацией.

Во время шахматной партии участники могут записывать или запоминать все выполненные ходы. Это устраняет стратегическую неопределённость. Следовательно, шахматы относятся к играм с совершенной информацией.

В шахматах нет элемента случайности. Никакое случайное событие не может повлиять на исход партии. Когда нет внешней неопределённости, игроки могут просчитывать будущие ходы. Поэтому шахматы относятся к детерминированным играм.

Во время турнира одни и те же игроки часто играют друг с другом несколько раз. При этом во время партии каждый из них делает несколько ходов. Поэтому шахматы — это многократная и многоходовая игра.

Правила игры фиксированные. На турнирах каждому игроку отводится определённое время на все ходы. Количество времени зависит от типа турнира. Чаще всего применяют следующие правила:

* **Классический**. На первые 40 ходов каждому игроку отводится 90 минут. После 40-ого хода каждому игроку добавляется 30 минут. К этим 30 минутам добавляется по 30 секунд за каждый ход, сделанный с начала партии.

* **Рапид** (rapid). Каждому игроку отводится от 10 до 60 минут на все ходы.

* **Блиц** (blitz). Игрокам отводится от 3 до 10 минут на ходы.

* **Буллит** (bullet). Игроки имеют менее 3-х минут на ходы.

* **Армагеддон** (armageddon). Игрок за чёрные фигуры выигрывает в случае ничьей. Ему отводится на 1 минуту меньше времени, чем игроку за белые фигуры. Обычно, белые имеют 6 или 5 минут на все ходы. Соответственно чёрные имеют 5 или 4 минуты.

Шахматы — это игра с нулевой суммой для двух участников. Поэтому игроки не могут договориться о совместных действиях. Это означает, что игра некооперативная. Единственный вид договорённости в шахматах: когда один из участников предлагает ничью, а другой на неё соглашается.

Во время партии каждый игрок имеет право ходить только своими фигурами. Поэтому шахматы относятся к пристрастным играм.

Шахматная доска имеет 64 клетки. В начале игры каждый участник имеет по 16 фигур. В течении партии число фигур на доске уменьшается. Это значит, что число возможных позиций фигур на доске конечно. Из этого следует, что число стратегий у каждого игрока тоже конечное. Таким образом шахматы — это дискретная игра.

Подведём итог. С точки зрения теории игр шахматы — это:

* Последовательная игра
* Игра с нулевой суммой
* Игра с полной информацией
* Игра с совершенной информацией
* Детерминированная игра
* Многократная и многоходовая игра
* Фиксированные правила
* Некооперативная игра
* Пристрастная игра
* Дискретная игра

### Решение игры

Посмотрим, что говорит теория игр о решении шахмат. Мы уже знаем, что последовательную игру удобнее представлять в развёрнутой форме. Для этого надо построить дерево игры. Сделать это возможно, поскольку в шахматной партии конечное число ходов. Далее применив метод обратной индукции, можно найти решение игры.

Исходная позиция фигур на доске будет начальным узлом дерева. Эту позицию демонстрирует иллюстрация 3-1.

{caption: "Иллюстрация 3-1. Начальная позиция фигур на шахматной доске", height: "30%"}
![Начальная позиция](images/Chess/chess-initial-position.png)

Первым ходит игрок с белыми фигурами. У него есть 20 возможных ходов из начальной позиции. Каждая из восьми пешка может сходить вперед на одну или две клетки. Каждый из двух коней может пойти буквой Г направо или налево. Это значит, что из начального узла дерева исходит 20 ветвей.

Каждая из 20 ветвей заканчивается узлом действия. В этом узле ходит игрок с чёрными фигурами. У него тоже есть 20 аналогичных ходов: пешками и конями. Следовательно из каждого узла действия исходит ещё 20 ветвей.

После двух ходов игроков мы получили 400 узлов действия. На третьем ходу у белых есть 26 возможных ходов. На каждый из них чёрные отвечают своими 26-ю ходами. Это значит, что на четвёртом ходу дерево решений содержит 270400 узлов действия.

Число узлов в дереве решений растёт стремительно. Какой же будет его конечный размер? Этим вопросом заинтересовался американский математик [Клод Шеннон](https://ru.wikipedia.org/wiki/Шеннон,_Клод). В 1950 году он [оценил](https://ru.wikipedia.org/wiki/Число_Шеннона) сложность игры в шахматы. Согласно его оценке, число возможных позиций фигур на шахматной доске примерно равно 10^44^. При этом [**сложность дерева игры**](https://en.wikipedia.org/wiki/Game_complexity#Game-tree_complexity) составляет примерно 10^120^. Эта сложность означает число узлов в дереве решения игры.

Из-за огромного размера дерева игры в шахматы его нельзя построить и проанализировать. Нет компьютера с достаточной памятью, чтобы сохранить все узлы дерева. Кроме того чтобы проанализировать эти узлы, самому мощному современному компьютеру понадобится около 10^100^ лет.

Получает, что теоретически игру в шахматы можно решить инструментами теории игр. Однако, у нас нет физической возможности это сделать. Как же тогда играют в шахматы профессионалы?

### Шахматная теория

Считается, что теория игры в шахматы началась с 1497 года. В этом году испанский шахматист [Луис Рамирес Лусена](https://ru.wikipedia.org/wiki/Рамирес_Лусена,_Луис) опубликовал первое печатное руководство под названием "Повторение любви и шахматного искусства". С тех пор были опубликованы десятки тысяч книг об этой игре.

Шахматная теория даёт практические советы о ведении игры. Рассмотрим кратко идеи этой теории. Они помогут нам понять, как игроки-люди справляются со сложностью шахмат.

Прежде всего шахматная теория рассматривает игру с двух точек зрения:

* [Стратегия](https://en.wikipedia.org/wiki/Chess_strategy)

* [Тактика](https://en.wikipedia.org/wiki/Chess_tactic)

**Шахматная стратегия** изучает следующие аспекты игры:

* Оценка фигур и их комбинаций на разных стадиях партии.

* Оценка шахматных позиций.

* Постановка целей.

* Долгосрочные планы действий в партии.

**Шахматная тактика** изучает последовательности ходов, которые ограничивают возможности соперника и приводят к выгоде.

Сравнить шахматную стратегию и тактику можно так: успешная тактика даёт преимущества в краткосрочной перспективе, а успешная стратегия — в долгосрочной. Кроме того тактические действия требуют от оппонента немедленного ответа. При стратегических действиях, у оппонента остаётся больше времени и вариантов ходов для ответа.

В рамках шахматной стратегии партия делится на три этапа:

* [**Дебют**](https://ru.wikipedia.org/wiki/Дебют_(шахматы)) (opening) — начало партии. К дебюту относятся первые 15-20 ходов.

* [**Миттельшпиль**](https://ru.wikipedia.org/wiki/Миттельшпиль) (middlegame) — середина партии. Миттельшпиль начинается примерно с 20-25 хода.

* [**Эндшпиль**](https://ru.wikipedia.org/wiki/Эндшпиль) (endgame) — конец партии. Эндшпиль начинается, когда на доске осталось мало фигур.

Рассмотрим, как профессиональные шахматисты отыгрывают каждый из этих этапов.

#### Дебют

Дебют считается наиболее проработанной частью партии с точки зрения теории. Самая первая шахматная книга 1497 года Лусена рассматривала 11 популярных в то время дебютов.

Сегодня все известные и часто играемые шахматные дебюты собраны в международной системе под названием [Энциклопедия шахматных дебютов](https://ru.wikipedia.org/wiki/Энциклопедия_шахматных_дебютов) (Encyclopedia of Chess Openings или ECO). В этой системе все дебюты описаны в [**алгебраической нотации**](https://ru.wikipedia.org/wiki/Алгебраическая_нотация). Это международный стандарт обозначения фигур и их позиций на доске.

Система ECO делит все дебюты на 5 групп: A, B, C, D и E. Группа определяет общий тип дебюта (например, открытый или закрытый). Благодаря классификации, дебюты легче запомнить.

На турнирах игроки предпочитают играть стандартные дебюты из системы ECO. Почему не принято придумывать и разыгрывать новые дебюты? Считается, что дебюты из ECO — это последовательности лучших первых ходов для каждой стороны. Эти ходы многократно анализировали самые уважаемые теоретики шахматной игры. Они доказали, что стороны не могут получить лучшее преимущество, играя иначе.

Из 20-ти возможных первых ходов белых 7 считаются "правильными". Остальные 13 ходов называются "неправильными". Они изучены намного хуже "правильных". Считается, что "правильные" ходы лучше и дают большее преимущество. На современных турнирах их отыгрывают в 99.4% случаев.

Предположим, что белая сторона отыгрывает стандартный дебют из ECO, а игрок за чёрных сам придумывает ответные ходы. В этом случае черная сторона получит худшую позицию в миттельшпиле. Это произойдёт по двум причинам.

Во-первых, игроку за белые фигуры не надо думать. Он делает лучшие ходы по памяти. Поэтому он не тратит своё игровое время. Игрок за чёрных должен анализировать ходы противника. Он просчитывает возможные последствия своих действий, а это требует времени. В турнирных партиях время ограничено, поэтому тратить его на дебют нерацинально.

Во-вторых, игрок за чёрных может просто не найти лучший ответный ход самостоятельно. Это значит, что играя лучшими ходами против посредственных ходов, белые получат преимущество в позиции или взятых фигурах.

Хорошая проработанность дебютов приводит к тому, что обоим игрокам выгодно отыгрывать стандартное начало партии. Так они экономят время и получают наилучший возможный результат.

Профессиональные шахматисты заучивают все известные дебюты наизусть. Каждый такой дебют имеет несколько вариантов до 15-20 хода. Далее профессионалы выбирают несколько дебютов, которые они прорабатывают и запоминают ещё тщательнее. Например, это может быть проработка до 25-30 хода. Именно эти проработанные варианты опытные шахматисты отыгрывают с сильными противниками.

Успех в начале игры двух сильных шахматистов решает подготовка. Предположим, первый игрок проработал отыгрываемый дебют на большее число ходов, чем другой. Тогда первый игрок получает как минимум преимущество по игровому времени. Если ему повезёт, один из ходов второго игрока будет не лучшим. В этом случае первый игрок получит преимущество.

В проработке дебютов заключается подготовка профессиональных шахматистов друг к другу. Каждый из них знает, какие дебюты оппонент отыгрывает чаще. Именно к ним и нужно готовиться лучше. Информация по всем отыгранным партиям на турнирах доступна через Internet в [базах данных](https://www.chess.com/games).

Иногда в ходе подготовки шахматисту удаётся найти ранее неизвестный хороший ход для одного из известных дебютов. Такой не упомянутый в ECO ход называется "новинкой". Новинка создаёт преимущество. Шахматист стремится свести партию к соответствующей позиции и сыграть её против сильного противника.

Многие известные шахматисты считают заучивание известных дебютов проблемой. Это приводит к тому, что любители могут отыгрывать дебюты на уровне лучших шахматистов. В результате на турнирах растёт число партий, сыгранных в ничью. Это уменьшает их зрелищность.

Предпринимались неоднократные попытки изменить правила шахмат, чтобы решить проблему заучивания дебютов. Самой успешной оказалась попытка 11-ого чемпиона мира по шахматам [Роберта Фишера](https://ru.wikipedia.org/wiki/Фишер,_Роберт_Джеймс). В его варианте игры [шахматы-960](https://ru.wikipedia.org/wiki/Шахматы-960) начальная расстановка фигур выбирается случайно с несколькими ограничениями. По шахматам Фишера проводятся турниры начиная с 1996 года. Именно в этом году Фишер представил правила этой игры широкой публике.

Несмотря на проблему с заучиванием дебютов, большинство турниров по-прежнему проводятся по правилам классических шахмат.

#### Миттельшпиль

Миттельшпиль намного хуже проработан шахматной теорией по сравнению с дебютом и эндшпилем. Именно в середине игры число возможных позиций фигур на доске наиболее велико. Это значит, что дерево игры разрастается в ширину и у каждого игрока есть огромное количество возможных ходов.

Играя в миттельшпиле, профессиональные шахматисты просчитывают свои самые перспективные ходы и возможные ответы оппонента.

Максимум человек успевает просчитать 5-10 следующих ходов в дереве игры. После этих ходов игра обычно не заканчивается. Поэтому оценивать последствия ходов приходится по промежуточному результату. **Функция промежуточной оценки** позволяет рассчитать выигрыши игроков в не концевых узлах дерева игры.

Чтобы выбрать из всех доступных ходов самые перспективные и оценить их результаты, шахматисты применяют знания о стратегии и тактике игры. Эти знания представляют собой универсальные правила, которые выводятся из прошлого опыта. Такой опыт накапливался поколениями шахматистов во многих партиях. Затем он проверялся и излагался в шахматных книгах.

Существует несколько [**шахматных школ**](https://ru.wikipedia.org/wiki/Шахматная_школа). Школой называется группа сильных шахматистов мирового уровня, которые придерживаются определённых взглядов на шахматную стратегию и тактику. Таким образом некоторые правила для функции промежуточной оценки зависят от школы и стиля игры каждого шахматиста.

Рассмотрим пример универсального правила. Шахматная стратегия говорит, что фигуры конь и слон имеют равную ценность. Однако, в закрытых позициях конь оказывается полезнее, благодаря своей способности перепрыгивать через другие фигуры. Закрытые позиции означают, что многие диагонали и линии на доске заблокированы пешками.

В открытых позициях, когда многие диагонали и линии свободны, наоборот ценнее слон. Это происходит потому, что слон может двигаться по диагонали на произвольное число клеток. Поэтому слон контролирует большую часть доски, чем конь.

Используя универсальное правило о ценности коня и слона в разных позициях, шахматист может оценить результат размена такими фигурами. Если на доске сложилась закрытая позиция, то размен слона на коня оппонента даст небольшое преимущество. Следовательно, ход, которой приведёт к такому размену, можно считать выигрышным с точки зрения функции промежуточной оценки.

Универсальных правил из стратегии и тактики достаточно много. Они также как и дебюты подробно разобраны в шахматных книгах. Профессиональные шахматисты запоминают все эти правила.

Кроме универсальных правил шахматисты используют интуицию. По своему прошлому опыту игрок может предсказать, какой ход или позиция окажется лучше других в каждой конкретной ситуации. Именно сочетание знаний и интуиции называется искусством игры в шахматы.

#### Эндшпиль

Когда партия переходит в эндшпиль, на доске остаётся совсем немного фигур. Это означает, что у каждого игрока есть не так много вариантов сделать ход. Поэтому размер дерева игры уменьшается. Часто у игроков появляется возможность применить метод обратной индукции и найти выигрышную последовательность ходов.

Шахматная теория подробно разбирает типичные эндшпили. Они классифицируются в зависимости от набора фигур у каждой стороны. Одни наборы фигур приводят к ничьей, если обе стороны ведут правильную игру. Другие наборы фигур гарантируют победу для одной из сторон.

Профессиональные шахматисты хорошо знают теорию эндшпилей. Поэтому партии на высоком уровне заканчиваются, когда игра сводится к хорошо известному эндшпилю с однозначным результатом. В этом случае, игрок с худшим положением сдаётся.

Чтобы правильно отыгрывать эндшпили, шахматисты заучивают стандартные наборы фигур и алгоритмы их передвижения. Следуя такому алгоритму можно гарантированно поставить мат противнику за конечное число ходов из любого начального расположения фигур.

Для эндшпилей заучивать алгоритмы оказывается эффективнее, чем конкретные ходы. Причина в том ,что в конце партии слишком много вариантов расположения оставшихся фигур на доске. Намного проще запомнить общий принцип взаимодействия фигур, чем конкретные ходы из каждой возможной позиции.

### Профессиональная игра

Профессиональные игроки активно пользуются приёмами игры, которые разработала шахматная теория. Она предлагает методы для уменьшения сложности дерева игры на каждом этапе партии. Кроме шахматной теории игроки применяют метод обратной индукции для оценки промежуточных результатов своих ходов. Этот метод особенно актуален в миттельшпиле и эндшпиле.

Итак мы выяснили, что профессиональные шахматисты комбинируют анализ частей дерева игры с развитой функцией промежуточной оценки. Это позволяет им принимать лучшие из возможных решений даже в случае, когда полный анализ дерева игры невозможен.